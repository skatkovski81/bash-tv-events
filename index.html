<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BASH TV – Upcoming Events</title>

<style>
  body{
    margin:0;
    background:transparent;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  }

  .tko-schedule-wrapper{
    max-width:1200px;
    margin:0 auto;
    padding:40px 16px 60px;
    color:#fff;
    box-sizing:border-box;
  }

  .tko-schedule-title-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    margin-bottom:18px;
  }

  .tko-schedule-title{
    font-size:28px;
    letter-spacing:.08em;
    text-transform:uppercase;
    margin:0;
    border-left:4px solid #fff;
    padding-left:12px;
  }

  /* NAV BUTTONS */
  .events-nav{ display:flex; gap:10px; flex-shrink:0; }
  .events-btn{
    width:42px;height:42px;border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.35);
    color:#fff;font-size:22px;cursor:pointer;line-height:1;
    display:flex;align-items:center;justify-content:center;
    user-select:none;
  }
  .events-btn:hover{ opacity:.9; }
  .events-btn:disabled{ opacity:.35; cursor:not-allowed; }

  /* ✅ SLIDER TRACK (hard no-wrap + horizontal scroll) */
  .tko-schedule-list{
    display:flex;
    flex-wrap: nowrap;              /* ✅ KEY FIX: never wrap to next line */
    gap:20px;
    overflow-x:auto;
    overflow-y:hidden;
    scroll-snap-type:x mandatory;
    -webkit-overflow-scrolling:touch;
    padding-bottom:10px;
  }

  /* Subtle scrollbar */
  .tko-schedule-list::-webkit-scrollbar{ height:8px; }
  .tko-schedule-list::-webkit-scrollbar-thumb{ border-radius:999px;background:rgba(255,255,255,.15); }
  .tko-schedule-list::-webkit-scrollbar-track{ background:transparent; }

  .tko-schedule-card{
    background:#050509;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.08);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    transition:transform .2s ease, box-shadow .2s ease;
    scroll-snap-align:start;

    /* ✅ 2 visible at a time on desktop */
    flex: 0 0 calc((100% - 20px) / 2);

    /* ✅ prevents 3 cards from squeezing into view on some widths */
    min-width: 420px;
  }

  .tko-schedule-card:hover{
    transform:translateY(-3px);
    box-shadow:0 14px 30px rgba(0,0,0,.7);
  }

  /* ✅ Image slot: always same shape */
.tko-schedule-thumb-wrap{
  width: 100%;
  aspect-ratio: 16 / 9;     /* <-- pick your universal shape */
  overflow: hidden;
  background:#111;
}

/* ✅ Image: crop-to-fill */
.tko-schedule-thumb{
  width: 100%;
  height: 100%;
  display:block;
  object-fit: cover;        /* key change */
  object-position: center;  /* center crop */
}

  .tko-schedule-card-header{ padding:14px 16px 8px; }
  .tko-schedule-event-name{
    font-size:16px;
    font-weight:600;
    text-transform:uppercase;
    margin-bottom:6px;
  }
  .tko-schedule-date-time{
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:.12em;
    color:#b7b7c2;
  }
  .tko-schedule-location{ font-size:12px;color:#b7b7c2; }

  .tko-schedule-footer{
    padding:10px 16px 14px;
    border-top:1px solid rgba(255,255,255,.08);
    display:flex;align-items:center;gap:10px;
  }
  .tko-schedule-tag{
    font-size:11px;
    letter-spacing:.14em;
    border-radius:999px;
    border:1px solid rgba(255,45,85,.6);
    padding:4px 10px;
    white-space:nowrap;
  }
  .tko-schedule-watch-btn{
    margin-left:auto;
    padding:8px 16px;
    font-size:11px;
    letter-spacing:.16em;
    border-radius:999px;
    background:#370000;
    color:#fff;
    text-decoration:none;
    white-space:nowrap;
    display:inline-flex;align-items:center;justify-content:center;
  }

  .tko-empty{
    margin-top:40px;
    border:1px dashed rgba(255,255,255,.2);
    border-radius:16px;
    padding:40px;
    text-align:center;
  }
  .tko-badge{
    display:inline-block;
    padding:6px 18px;
    border-radius:999px;
    font-size:11px;
    letter-spacing:.18em;
    background:rgba(55,0,0,.85);
    margin-bottom:14px;
  }

  /* ✅ Mobile: show 1 card at a time */
  @media (max-width: 900px){
    .tko-schedule-title{ font-size:22px; }
    .events-btn{ width:38px;height:38px; }

    .tko-schedule-card{
      flex: 0 0 86%;
      min-width: 0; /* let 86% control it on mobile */
    }
  }
</style>
</head>

<body>
  <div class="tko-schedule-wrapper">
    <div class="tko-schedule-title-row">
      <h2 class="tko-schedule-title">Upcoming Events</h2>

      <div class="events-nav" id="eventsNav">
        <button class="events-btn" id="eventsPrev" aria-label="Previous">‹</button>
        <button class="events-btn" id="eventsNext" aria-label="Next">›</button>
      </div>
    </div>

    <div class="tko-schedule-list" id="events"></div>

    <div class="tko-empty" id="empty" style="display:none;">
      <div class="tko-badge">Coming Soon</div>
      <div>Upcoming events coming soon.</div>
    </div>
  </div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRq-sQ4bWk9Xo6-l39RnWoU1WYT8KECFnkNJXrMUbCia_fL6pKTNevOyk8l-7e0QXZ5vjwIVtxw7I4p/pub?gid=0&single=true&output=csv";

function parseCSV(text){
  const rows = [];
  let row = [], cur = "", inQuotes = false;

  for (let i = 0; i < text.length; i++){
    const ch = text[i];
    const next = text[i+1];

    if (ch === '"'){
      if (inQuotes && next === '"'){ cur += '"'; i++; }
      else inQuotes = !inQuotes;
      continue;
    }
    if (!inQuotes && ch === ","){ row.push(cur); cur = ""; continue; }
    if (!inQuotes && (ch === "\n" || ch === "\r")){
      if (ch === "\r" && next === "\n") i++;
      row.push(cur); rows.push(row);
      row = []; cur = ""; continue;
    }
    cur += ch;
  }
  row.push(cur); rows.push(row);
  return rows.filter(r => r.some(c => String(c||"").trim() !== ""));
}

function cleanCell(v){
  let s = String(v ?? "").trim();
  if (s.startsWith('"') && s.endsWith('"')) s = s.slice(1, -1).trim();
  return s;
}

function normalizeKey(k){
  return cleanCell(k).toLowerCase().replace(/\s+/g,"_");
}

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;")
    .replaceAll(">","&gt;").replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function setupArrows(){
  const track = document.getElementById("events");
  const nav = document.getElementById("eventsNav");
  const prev = document.getElementById("eventsPrev");
  const next = document.getElementById("eventsNext");
  if (!track || !prev || !next || !nav) return;

  const cards = () => track.querySelectorAll(".tko-schedule-card");
  const gap = 20;

  function scrollByOne(dir){
    const first = track.querySelector(".tko-schedule-card");
    const w = first ? first.getBoundingClientRect().width : 420;
    track.scrollBy({ left: dir * (w + gap), behavior:"smooth" });
  }

  prev.addEventListener("click", () => scrollByOne(-1));
  next.addEventListener("click", () => scrollByOne(1));

  function refresh(){
    // Hide arrows if <= 2 cards (desktop requirement)
    const count = cards().length;
    nav.style.display = (count > 2) ? "flex" : "none";

    const maxScrollLeft = track.scrollWidth - track.clientWidth - 2;
    prev.disabled = track.scrollLeft <= 2;
    next.disabled = track.scrollLeft >= maxScrollLeft;
  }

  track.addEventListener("scroll", () => requestAnimationFrame(refresh));
  window.addEventListener("resize", refresh);
  refresh();
}

fetch(CSV_URL + "&cb=" + Date.now(), { cache: "no-store" })
  .then(res => res.text())
  .then(csv => {
    const rows = parseCSV(csv);
    if (rows.length < 2) throw new Error("No rows");

    const headers = rows[0].map(normalizeKey);
    const items = rows.slice(1).map(r => {
      const obj = {};
      headers.forEach((h, i) => obj[h] = cleanCell(r[i]));
      return obj;
    });

    const events = items
      .filter(e => (e.status || "").toLowerCase() !== "hide")
      .filter(e => (e.show || "").trim() !== "");

    const eventsEl = document.getElementById("events");
    const emptyEl  = document.getElementById("empty");

    if (!events.length){
      emptyEl.style.display = "block";
      eventsEl.innerHTML = "";
      return;
    }

    emptyEl.style.display = "none";

    eventsEl.innerHTML = events.map(e => {
      const img = (e.image || "").trim();
      const imgHtml = img
       ? `<img class="tko-schedule-thumb" src="${escapeHtml(img)}" alt="${escapeHtml(e.show)}" loading="lazy" decoding="async" referrerpolicy="no-referrer">`
        : `<div style="color:#b7b7c2;font-size:12px;letter-spacing:.12em;text-transform:uppercase;">No Image</div>`;

      const link = (e.button_url || "").trim();
      const btnText = (e.button_text || "Watch").trim();

      const btnHtml = link
        ? `<a class="tko-schedule-watch-btn" href="${escapeHtml(link)}" target="_blank" rel="noopener noreferrer">${escapeHtml(btnText)}</a>`
        : `<span class="tko-schedule-watch-btn" style="opacity:.55;cursor:not-allowed;">${escapeHtml(btnText)}</span>`;

      const dt = [e.date, e.time].filter(Boolean).join(" • ");

      return `
        <div class="tko-schedule-card">
          <div class="tko-schedule-thumb-wrap">${imgHtml}</div>
          <div class="tko-schedule-card-header">
            <div class="tko-schedule-event-name">${escapeHtml(e.show)}</div>
            ${dt ? `<div class="tko-schedule-date-time">${escapeHtml(dt)}</div>` : ``}
            ${e.location ? `<div class="tko-schedule-location">${escapeHtml(e.location)}</div>` : ``}
          </div>
          <div class="tko-schedule-footer">
            <div class="tko-schedule-tag">${escapeHtml(e.tag || "PPV")}</div>
            ${btnHtml}
          </div>
        </div>
      `;
    }).join("");

    setupArrows();
  })
  .catch(() => {
    const emptyEl  = document.getElementById("empty");
    if (emptyEl) emptyEl.style.display = "block";
  });
</script>

</body>
</html>
